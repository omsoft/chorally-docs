"use strict";(globalThis.webpackChunkmicroservices_docs=globalThis.webpackChunkmicroservices_docs||[]).push([[402],{7666:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>t,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"catalog/message_service/changelog","title":"Changelog","description":"Architettura","source":"@site/docs/catalog/message_service/changelog.md","sourceDirName":"catalog/message_service","slug":"/catalog/message_service/changelog","permalink":"/docs/catalog/message_service/changelog","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Changelog"},"sidebar":"tutorialSidebar","previous":{"title":"Troubleshooting","permalink":"/docs/catalog/message_service/troubleshooting"}}');var s=n(4848),o=n(8453);const r={title:"Changelog"},l="Documentazione Generale",t={},c=[{value:"Architettura",id:"architettura",level:2},{value:"Dipendenze",id:"dipendenze",level:2},{value:"Entit\xe0 Principali",id:"entit\xe0-principali",level:2},{value:"Ticket",id:"ticket",level:3},{value:"Messaggio",id:"messaggio",level:3},{value:"Origine",id:"origine",level:3},{value:"Coda",id:"coda",level:3},{value:"Elaborazioni in Background",id:"elaborazioni-in-background",level:2},{value:"Job Sidekiq",id:"job-sidekiq",level:3},{value:"Consumer Kafka",id:"consumer-kafka",level:3},{value:"Logiche di Funzionamento",id:"logiche-di-funzionamento",level:2},{value:"Quando arriva un messaggio da un canale social...",id:"quando-arriva-un-messaggio-da-un-canale-social",level:3},{value:"Configurazione dell&#39;Ambiente",id:"configurazione-dellambiente",level:2},{value:"Esecuzione del Servizio",id:"esecuzione-del-servizio",level:2},{value:"Server API",id:"server-api",level:3},{value:"Consumatore Kafka",id:"consumatore-kafka",level:3},{value:"Processore di Lavori in Background",id:"processore-di-lavori-in-background",level:3}];function d(e){const i={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.header,{children:(0,s.jsx)(i.h1,{id:"documentazione-generale",children:"Documentazione Generale"})}),"\n",(0,s.jsx)(i.h2,{id:"architettura",children:"Architettura"}),"\n",(0,s.jsx)(i.p,{children:"Il Servizio Messaggi segue un'architettura modulare con i seguenti componenti:"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"API"}),": Costruito con Grape, fornisce endpoint RESTful per i client"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Consumers"}),": Elabora i messaggi Kafka per la comunicazione basata su eventi"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Models"}),": Definisce le entit\xe0 di dominio e le loro relazioni"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Jobs"}),": Gestisce l'elaborazione asincrona utilizzando Sidekiq"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Services"}),": Contiene la logica di business per le operazioni su ticket, messaggi, origini e code"]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"dipendenze",children:"Dipendenze"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"MongoDB"}),": Archivio dati primario per tutte le entit\xe0"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Kafka"}),": Piattaforma di streaming di eventi per la comunicazione tra servizi"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Redis"}),": Utilizzato per l'elaborazione di lavori in background con Sidekiq"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"OpenSearch"}),": Motore di ricerca per l'indicizzazione e l'interrogazione dei messaggi"]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"entit\xe0-principali",children:"Entit\xe0 Principali"}),"\n",(0,s.jsx)(i.h3,{id:"ticket",children:"Ticket"}),"\n",(0,s.jsx)(i.p,{children:"Un ticket rappresenta un caso di supporto clienti. Contiene:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Messaggi da clienti e agenti di supporto"}),"\n",(0,s.jsx)(i.li,{children:"Informazioni sullo stato (creato, in lavorazione, in attesa, followup, risolto, chiuso)"}),"\n",(0,s.jsx)(i.li,{children:"Informazioni sull'assegnazione (proprietario, gruppo)"}),"\n",(0,s.jsx)(i.li,{children:"Metadati (sentiment, orario di ricezione, ecc.)"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"I ticket possono essere organizzati in code (queue) in base a regole."}),"\n",(0,s.jsx)(i.p,{children:"Alcune propriet\xe0 del ticket vengono generate/aggiornate in automatico:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.em,{children:"sequence"})," numerica che identifica in modo univoco il ticket all'interno di un tenant"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.em,{children:"valutazione cliente"})," presa dall'ultima recensione ricevuta (ove possibile, es. Trustpilot)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.em,{children:"metadati"})," come orario di apertura, orario ultimo messaggio, orario di chiusura, ecc."]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"messaggio",children:"Messaggio"}),"\n",(0,s.jsx)(i.p,{children:"Un messaggio rappresenta una singola comunicazione all'interno di un ticket. Pu\xf2 essere:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Messaggio del cliente"}),"\n",(0,s.jsx)(i.li,{children:"Risposta dell'agente"}),"\n",(0,s.jsx)(i.li,{children:"Nota interna"}),"\n",(0,s.jsx)(i.li,{children:"Messaggio generato dall'IA"}),"\n",(0,s.jsx)(i.li,{children:"Suggerimento generato dall'IA"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"I messaggi possono includere allegati e possono essere nascosti o eliminati."}),"\n",(0,s.jsx)(i.p,{children:"I messaggi vengono raggruppati in thread di conversazione in base alla coppia AUTORE-CANALE; questo perch\xe9 lo stesso utente pu\xf2 scrivere pi\xf9 volte nello stesso canale, anche a distanza di tempo, e Chorally tiene traccia di queste conversazioni tramite un unico thread."}),"\n",(0,s.jsx)(i.h3,{id:"origine",children:"Origine"}),"\n",(0,s.jsx)(i.p,{children:"Un'origine rappresenta un canale di comunicazione. Gli esempi includono:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Facebook (post pubblici, messaggistica)"}),"\n",(0,s.jsx)(i.li,{children:"Instagram (commenti, menzioni, messaggistica)"}),"\n",(0,s.jsx)(i.li,{children:"X/Twitter (menzioni)"}),"\n",(0,s.jsx)(i.li,{children:"WhatsApp"}),"\n",(0,s.jsx)(i.li,{children:"LinkedIn"}),"\n",(0,s.jsx)(i.li,{children:"Mail"}),"\n",(0,s.jsx)(i.li,{children:"Chat incorporata"}),"\n",(0,s.jsx)(i.li,{children:"ecc"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Ogni origine ha uno stato e impostazioni specifiche."}),"\n",(0,s.jsx)(i.h3,{id:"coda",children:"Coda"}),"\n",(0,s.jsx)(i.p,{children:"Una coda organizza i ticket in base a regole. Pu\xf2 essere:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Assegnata a gruppi o utenti specifici"}),"\n",(0,s.jsx)(i.li,{children:"Configurata con contatori per diversi stati dei ticket"}),"\n",(0,s.jsx)(i.li,{children:"Ordinata per priorit\xe0"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"elaborazioni-in-background",children:"Elaborazioni in Background"}),"\n",(0,s.jsx)(i.p,{children:"Il servizio opera in modo asincrono sui dati attraverso 2 modalit\xe0:"}),"\n",(0,s.jsx)(i.h3,{id:"job-sidekiq",children:"Job Sidekiq"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Chiusura"}),": Chiude automaticamente i ticket dopo un periodo di tempo specificato appena entrano nello stato ",(0,s.jsx)(i.em,{children:"solved"})]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Followup"}),": Fa transitare i ticket dallo stato di followup allo stato di lavorazione allo scadere del tempo di followup precedentemente impostato dall'operatore"]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"consumer-kafka",children:"Consumer Kafka"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Consumer di Messaggi"}),": Elabora i messaggi in arrivo da vari canali"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Consumer di Ticket"}),": Gestisce gli eventi relativi ai ticket"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Consumer di Code"}),": Elabora gli eventi relativi alle code"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Consumer di Messaggi IA"}),": Gestisce gli eventi dei messaggi generati dall'IA"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Consumer di Metadati"}),": Rileva gli aggiornamenti dei metadati (tag, topic, custom fields) per spostare i ticket nelle code rispettando le condizioni configurate"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Consumer di Chiusura Escalation"}),": Gestisce gli eventi di chiusura dell'escalation"]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"logiche-di-funzionamento",children:"Logiche di Funzionamento"}),"\n",(0,s.jsx)(i.h3,{id:"quando-arriva-un-messaggio-da-un-canale-social",children:"Quando arriva un messaggio da un canale social..."}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsx)(i.li,{children:"Il messaggio viene processato dal consumer di Messaggi"}),"\n",(0,s.jsxs)(i.li,{children:["Il messaggio viene organizzato in ticket (",(0,s.jsx)(i.em,{children:"se esiste un ticket ancora aperto appartenente allo stesso utente-canale il messaggio viene accodato, altrimenti viene aperto un nuovo ticket"}),")"]}),"\n",(0,s.jsx)(i.li,{children:"Il ticket viene assegnato alle code in base alle regole"}),"\n",(0,s.jsx)(i.li,{children:"Gli agenti di supporto lavorano sui ticket attraverso l'API"}),"\n",(0,s.jsx)(i.li,{children:"I ticket progrediscono attraverso gli stati (creato \u2192 in lavorazione \u2192 in attesa \u2192 risolto \u2192 chiuso)"}),"\n",(0,s.jsx)(i.li,{children:"I job in background gestiscono le transizioni automatiche di stato (scadenza del followup, chiusura automatica)"}),"\n",(0,s.jsx)(i.li,{children:"Le rule in background gestiscono le azioni (risposte automatiche, ecc)"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"configurazione-dellambiente",children:"Configurazione dell'Ambiente"}),"\n",(0,s.jsx)(i.p,{children:"Il servizio richiede diverse variabili d'ambiente per un corretto funzionamento:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Configurazione Kafka (KAFKA_HOST, KAFKA_REPLICATION_FACTOR)"}),"\n",(0,s.jsx)(i.li,{children:"Configurazione MongoDB (MONGODB_HOST, MONGODB_PORT, MONGODB_USERNAME, MONGODB_PASSWORD)"}),"\n",(0,s.jsx)(i.li,{children:"Configurazione Redis (REDIS_HOST, REDIS_PORT, REDIS_USERNAME, REDIS_PASSWORD)"}),"\n",(0,s.jsx)(i.li,{children:"Configurazione OpenSearch (OPENSEARCH_HOST, OPENSEARCH_PORT, OPENSEARCH_USERNAME, OPENSEARCH_PASSWORD)"}),"\n",(0,s.jsx)(i.li,{children:"Impostazioni specifiche del servizio (TICKET_CLOSED_AFTER_MINS, SIDEKIQ_MAX_RETRIES)"}),"\n",(0,s.jsx)(i.li,{children:"URL dei servizi esterni (USER_SERVICE_URL, TICKET_HELPER_SERVICE_URL)"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Per una lista aggiornata e dettagliata delle variabili d'ambiente consultare il README sul repository del progetto."}),"\n",(0,s.jsx)(i.h2,{id:"esecuzione-del-servizio",children:"Esecuzione del Servizio"}),"\n",(0,s.jsx)(i.h3,{id:"server-api",children:"Server API"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"./bin/run_puma.sh\n"})}),"\n",(0,s.jsx)(i.h3,{id:"consumatore-kafka",children:"Consumatore Kafka"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"./bin/run_karafka.sh\n"})}),"\n",(0,s.jsx)(i.h3,{id:"processore-di-lavori-in-background",children:"Processore di Lavori in Background"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"bundle exec sidekiq\n"})})]})}function u(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>r,x:()=>l});var a=n(6540);const s={},o=a.createContext(s);function r(e){const i=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(o.Provider,{value:i},e.children)}}}]);