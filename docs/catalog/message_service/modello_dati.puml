@startuml "Message Service Data Model"

!pragma layout smetana

skinparam classAttributeIconSize 0
skinparam monochrome true
skinparam shadowing false
skinparam packageStyle rectangle

title "Message Service - Modello Dati"

class Message {
  +String author
  +String author_name
  +String body
  +String external_id
  +String reply_to
  +StringifiedSymbol reply_kind
  +Array attachments
  +DateTime received_at
  +Boolean note
  +Boolean shadowed
  +Boolean hidden
  +Boolean deleted
  +Boolean is_operator_reply
  +Boolean is_escalation
  +Boolean is_external_reply
  +String template_id
  +String origin_id
}

class Thread {
  +String external_id
  +String body
  +Array attachment_urls
}

class Ticket {
  +String group
  +String owner
  +String owner_name
  +String title
  +DateTime received_at
  +StringifiedSymbol sentiment
  +Integer sequence
  +Boolean outbound
  +Boolean is_conversation
  +DateTime followed_up_to
  +String author
  +DateTime last_message_received_at
  +DateTime last_customer_received_at
  +Integer count_visible_messages
  +String state
  +DateTime closed_at
}

class Origin {
  +String name
  +String external_id
  +String owner
  +StringifiedSymbol kind
  +StringifiedSymbol channel
  +Boolean active
  +Boolean public
  +Boolean outbound
  +Hash capabilities
  +String description
  +Integer close_after_solve
  +Integer close_after_wait
}

class Queue {
  +String name
  +String description
  +String owner
  +Integer order
  +Array groups
  +Array users
  +Boolean status
  +Array rules
  +String rule
}

class QueueCounter {
  +String name
  +Array states
}

class TicketStateTransition {
  +String namespace
  +String event
  +String from
  +String to
  +DateTime created_at
}

' Definizione delle relazioni
Origin "1" -- "0..*" Thread : ha >
Origin "1" -- "0..*" Ticket : ha >

Thread "0..1" -- "0..*" Message : contiene >

Ticket "1" -- "0..*" Message : contiene >
Ticket "0..*" -- "0..*" Queue : appartiene >
Ticket "1" o-- "0..*" TicketStateTransition : incorpora >

Queue "1" *-- "0..*" QueueCounter : incorpora >

note "Un Message appartiene sempre a un Ticket\nUn Message pu√≤ appartenere a un Thread (opzionale)" as N1
Message .. N1

note "I ticket possono trovarsi in uno dei seguenti stati:\n- created: Appena creato\n- replied: Risposto\n- closed: Chiuso\n- followedup: Seguito\n- solved: Risolto\n- pending: In attesa\n- working: In lavorazione" as N2
Ticket .. N2

note "Tipi di origine (kind):\n- facebook_public\n- facebook_feed\n- instagram_comment\n- x_mention\n- ecc." as N3
Origin .. N3

@enduml